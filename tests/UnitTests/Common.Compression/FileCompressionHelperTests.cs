namespace Naos.Core.UnitTests.Common.Compression
{
    using System;
    using System.IO;
    using Naos.Foundation;
    using Shouldly;
    using Xunit;

    public class FileCompressionHelperTests
    {
        [Fact]
        public void CompressionRoundtrip_Test()
        {
            // arrange, write test file
            var path = Path.Combine($"test-{Guid.NewGuid().ToString("N").Substring(10)}");
            const string content = "ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456ABCDEFGHIJKLMNOP123456";

            using(var writer = new StreamWriter(path + ".txt"))
            {
                writer.WriteLine(content);
            }

            // act
            FileCompressionHelper.Compress(path + ".txt");
            FileCompressionHelper.Decompress(path + ".gz", path + ".new.txt");

            // assert
            File.ReadAllLines(path + ".new.txt")[0].ShouldBe(content);
        }
    }
}
